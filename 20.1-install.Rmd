## Install and Set Up Bookdown {- #install}
Below are steps we followed to set up the Bookdown publishing platform and related tools for this book, using our Macintosh OS 10.14 computers. The same general principles also should apply to Windows computers. No special knowledge is required, but these tools may not be ideal for novice computer users. Installation steps---and inevitable problems that pop up---will be easier if you are comfortable with exploring your computer, or already have some familiarity with text editors, GitHub, or R Studio.

1. Install R Project statistical programming language <https://www.r-project.org>, which is required by Bookdown. [See screenshot](images/20-bookdown/1-r-download.png)

2. Install the free version of RStudio Desktop to make R easier to use with a visual editor. [See screenshot](images/20-bookdown/2-download-rstudio.png). Some authors compose their books in RStudio, but you may use any text editor. Our personal preference is the [Atom editor](https://atom.io/) from GitHub.

3. Inside RStudio, select the Packages tab, and select Install. [See screenshot](images/bookdown/3-packages-install.png)

4. Inside RStudio, install the "bookdown" package to build your book, and select Install Dependencies. [See screenshot](images/20-bookdown/4-install-bookdown.png)

5. Bookdown now should be successfully installed in RStudio. [See screenshot](images/20-bookdown/5-installed.png)

6. For Bookdown to create a PDF edition of your book, you need to install a [LaTeX](https://en.wikipedia.org/wiki/LaTeX) engine to prepare your Markdown plain text, citations, and images into stylized pages. Since the full-sized [LaTeX project](https://www.latex-project.org/get/) is very large, Bookdown recommends the smaller TinyTeX package. Inside RStudio, select the Packages tab, select Install, and enter "tinytex" to find and upload the package. [See screenshot](images/20-bookdown/6-install-tinytex.png)

7. To finish installing tinytex, in the RStudio console, type `tinytex::install_tinytex()` and press return. [See screenshot](images/20-bookdown/7-finish-install-tinytex.png)

8. When you installed RStudio, it also should have installed its own version of Pandoc, the package that converts files from Markdown format to HMTL and other formats. To confirm the Pandoc installation and version number, in the RStudio console, type `rmarkdown::pandoc_version()` and press return. The resulting version number should be `2.3.1` or higher. To install a newer version of Pandoc, which is highly recommended, go to <https://pandoc.org>.

### Download, Build, and Host a Sample Bookdown Book {-}
While Bookdown does not require you to use GitHub, these steps show how to integrate these tools to make your own copy of a sample Bookdown book.

1. Create a free [GitHub](https://github.com) account to simplify steps for the next two sections. While Bookdown does not require you to use GitHub, the workflow described below features GitHub to copy a sample Bookdown template and to host your own Bookdown editions online. To learn more about the basics of this tool, see [Chapter 11: Edit and Host Code with GitHub](github.html).

2. In your web browser, log into your GitHub account, go to the Bookdown developer's `bookdown-minimal` repo <https://github.com/yihui/bookdown-minimal>, and fork a copy to your GitHub account.

3. Install GitHub Desktop <https://desktop.github.com> to transfer files between your online GitHub repo and local computer. While software developers may prefer to access GitHub by typing commands in their terminal, GitHub Desktop provides easier point-and-click access for most users.

4. In your web browser, go to your forked copy of `bookdown-minimal`, click the green `Code` button, and select `Open in Desktop`. This should automatically open the GitHub Desktop application, and you can navigate where you wish to store a copy of your code repo on a folder in your local computer.

5. In RStudio in the upper-right corner, select Project > Open Project to open the `bookdown-minimal` folder on your local computer. [See screenshot](images/20-bookdown/8-project-open.png)

6. In RStudio, open the `index.Rmd` file and make some simple edits to the text of this minimal book. For example, remove the hashtag `#` comment symbol in line 8 to "uncomment" and activate the PDF book option. Save your edits. [See screenshot](images/20-bookdown/9-edit-book.png)

7. Optional: If you wish, you can modify your `bookdown-minimal` files outside of RStudio, by using your preferred text editor, such as Atom editor <https://atom.io>.

8. In RStudio, upper-right corner, select the Build tab, select Build Book, and choose All Formats to build both the gitbook-style static web edition and PDF edition.

9. If RStudio successfully builds both editions of your minimal book, the output will be saved into your `bookdown-minimal` folder, in a subfolder named `_book`, because that's how this sample is configured. The RStudio internal browser should automatically open your web edition (but it's not a very good browser, so we typically close it and manually open the `index.html` file with our regular browser.)

10. Also, open the subfolder and inspect the PDF edition of your book. If any errors were generated in the process, error messages will appear in red type in the RStudio Build viewer, which may require you to debug errors and delete temporary files as instructed. [See screenshot](images/20-bookdown/11-successful-build.png).

Tip: In future sessions with RStudio, you should select the Packages tab and click Update to keep Bookdown and other software packages up to date. [See screenshot](images/20-bookdown/12-packages-update.png)

11. Close your project, and quit RStudio. The next set of steps will focus on pushing your edited book to your GitHub repository using the GitHub Desktop tool.

12. Open GitHub Desktop and navigate to the `bookdown-minimal` folder on your local computer. Write a quick summary to commit (or save) the changes you made above to your master branch, and push this version to your online GitHub repo.

13. In your web browser, go to your online GitHub repo, with a web address similar to `https://github.com/USERNAME/bookdown-minimal`.

14. In your GitHub repo, select Settings, and scroll down to the GitHub Pages section, which is a free web hosting service to publish your code and book editions on the public web. Change the Source from None to Main, keep the default */root* option in the middle, and press Save.

15. Scroll down to the GitHub Pages section again, and the web address of your published site should appear similar to `https://USERNAME.github.io/bookdown-minimal`.

16. Copy your published web address from above, paste into a new browser tab, and at the end add `_book/index.html`. The reason is because your sample book is configured by default to store all web and PDF editions in your `_book` subfolder, with `index.html` serving as the home page. Therefore, the full web address in your new browser tab should be similar to: `https://USERNAME.github.io/bookdown-minimal/_book/index.html`

Tip: You may need to wait up to one minute for edits to your GitHub online repo to appear live at your GitHub Pages web address. Also, after waiting for GitHub Pages to make changes, be sure to "force reload" or "hard refresh" your web browser to update directly from the GitHub Pages server, not the browser's internal cache.

### Customize Bookdown and GitHub Settings and Domain Name {-}
To see the file structure, settings, and content for this *On The Line* book, view its online repository at <https://github.com/ontheline/ontheline-bookdown>. See more details about configuration settings, see Yihui Xie's [Bookdown technical guide](https://bookdown.org/yihui/bookdown).

In this book, the `_bookdown.yml` file is set to build all of the book outputs (Web edition, PDF edition, etc.) in directory folder named `docs` in the GitHub repo as shown below. (Proper indenting is important here.) **TODO: change for PDF output prior to PDF publication, see Style Guide.**

```
output_dir: "docs"
book_filename: "Dougherty-etal-OnTheLine"
language:
  label:
    fig: "Figure "
    tab: "Table "
chapter_name: "Chapter "
```

In this book, the Bookdown setting has been changed from the default `_books` folder to the `docs` folder to take advantage of the GitHub Pages setting that allows hosting online content from the `master/docs` folder, rather than the entire `master` branch. Choosing these Bookdown and GitHub Pages settings allows authors to publicly share their book source code and raw text on the `master` branch, **and** host online the Web and ebook editions from the `master/docs` subfolder of that branch. (Years earlier, GitHub previously required users to separate these tasks on two different branches, typically called `master` and `gh-pages`, but now users can do both through one branch, which is simpler.) Also, following this `master/docs` method simplifies the address of your GitHub Pages published web edition to this format: `https://USERNAME.github.com/REPONAME`. (See further below about customizing the web address.) Finally, the `docs` folder contains an empty `.nojekyll` file so that GitHub Pages does not attempt to process these static HTML pages in Jekyll.

In this book, the `index.Rmd` file is set to produce the Web edition in the GitBook style, with additional settings explained further below. (Proper indenting is important here.)
```
output:
  bookdown::gitbook:
    dev: svglite
    css: css/style.css
    includes:
      in_header: [custom-scripts.html, google-analytics-otl.html]
    split_by: section
    split_bib: true
    number_sections: true
```
Here is a simplified description of the root file structure in the GitHub repo for this book:

- Preface of the book with non-numbered sections: `index.Rmd`
- Chapters with first-level headers, such as: `01-chapter.Rmd`
- Subchapters with second-level headers such as `01.1-subchapter.Rmd` and `01.2-subchapter.Rmd`. While Bookdown refers to these as sections, in this book they are referred to as subchapters.
- The `images` folder, where JPG, PNG, and PDFs to display in chapters are located.
- The `docs` folder, which contains the published book products, such as Web edition (`index.html`, `introduction.html`, etc.), the PDF edition (`Dougherty-etal-OnTheLine.pdf`), etc.
- Additional helper files described further below.

When you change the names of chapters/sections, Bookdown builds new HMTL pages based on those new names, but old HMTL pages based on old chapter/section names may still exist in the same subfolder. To avoid confusion, you may wish to carefully delete old HTML pages in `docs` whenever you significantly alter names and build a new version of the book.

In addition, this GitHub Pages repo is published with a custom domain name <https://OnTheLine.trincoll.edu>. Learn more about custom domain names at <https://help.github.com/articles/using-a-custom-domain-with-github-pages/>. Typically, a custom domain name is purchased from a web hosting service, such as [ReclaimHosting](http://reclaimhosting.com), and you may need customer support to access the Manage DNS (domain name system) to point your new URL to your GitHub Pages online site. For this book's custom domain name, <https://ontheline.trincoll.edu>, the IT staff at Trinity College created a subdomain on their .edu domain, which shows that my scholarship is affiliated with an academic institution. For comparison, see our other Bookdown book, <https://datavizforall.org>, for which we intentionally purchased our own domain name. Adding a GitHub Pages custom domain name creates an additional `CNAME` file in the `docs` subfolder. Avoid accidentally erasing the `CNAME` file if you need to clear out any old HTML files in your subfolder.

The web edition of this book includes two custom files that are referenced in the `index.Rmd` file header, and are generated into the web edition when building the book:
```
output:
  bookdown::gitbook:
    dev: svglite
    css: css/style.css
    includes:
      in_header: google-analytics-otl.html
```

The `google-analytics-otl.html` file records web traffic with Google Analytics, if you create a free account and insert your code.

The web edition of this book also includes a custom `404.html` file that redirects any bad web addresses under the domain back to `index.html` page. A copy of this file must be manually transferred into the `docs` subfolder, because it is not automatically built by Bookdown.

In this book, the `index.Rmd` file also contains instructions to create endnotes and a bibliography from a Zotero-Better BibLaTeX exported file named `ontheline.bib`, in a specific Chicago-style format. Other `.csl` files are downloadable from the Zotero Styles Repository <https://www.zotero.org/styles>.
```
bibliography: ontheline.bib
citation-style: chicago-fullnote-bibliography.csl
```
Also in this book, the `index.Rmd` file is set to produce a PDF edition of the book with PanDoc settings for the desired Chicago-style footnotes and bibliography in the PDF edition. See more details at <https://pandoc.org/>. See additional PDF setting options at <https://bookdown.org/yihui/rmarkdown/pdf-document.html>.

```
  bookdown::pdf_book:
    citation_package: none
    pandoc_args: [ "--csl", "chicago-fullnote-bibliography.csl" ]
```

Also in this book, the `index.Rmd` file includes R global options to display each R chunk image without code (no echo), and to display the PDF version of an image file instead of JPG/PNG version whenever available.

```
{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(knitr.graphics.auto_pdf = TRUE)
```
