# Map Your Data {#map}
Maps draw your readers into data that includes a spatial dimension, while also developing a stronger sense of place. Seeing the relative distance between points on a map, or identifying geographic patterns in a *choropleth* map (where colored polygons represent data values), relays information to readers' eyes more effectively than text, tables, or charts. But creating meaningful maps that draw our attention to key insights in your data requires clear thinking about design choices.

In this chapter, we will examine [principles of map design](map-design.html) and distinguish between good and bad maps. You will learn about rules that apply to all maps, and specific guidelines for creating choropleth maps. While many tools allow you to download maps as *static* images, our book also demonstrates how to construct *interactive* charts that invite readers to zoom in and explore the data in their web browsers. Later you'll learn how to [embed interactive charts on your website in Chapter 10](embed.html).

Learn about different types of maps you can create in this book in Table \@ref(tab:map-types). Decisions about map types are based on two main factors: the format of your data, and the kind of story you wish to tell. For example, point maps work best to show specific locations with colored markers to represent categories (such as hospitals), while choropleth maps are best suited to display relative values for regions (such as birth rates across US states). After selecting your map type, follow our tool recommendations and step-by-step tutorials. This chapter features *Easy Tools* with drag-and-drop menus, such as [Google My Maps](mymaps.html), [Datawrapper](symbolmap-datawrapper.html), and [Tableau Public](map-tableau.html). But the table also points you to *Power Tools* that give you more control to customize and host your visualizations, such as [Leaflet code templates in Chapter 13](leaflet.html). These advanced tools require prior knowledge on how to [edit and host code templates with GitHub in Chapter 11](github.html).

TODO: Improve and standardize map images

Table: (\#tab:map-types) Basic Map Types, Best Uses, and Tutorials

| Map | Best use and tutorials in this book |
| --- | --- |
| Point map with custom icons<br> ![](images/08-map/map-point.png) | Best to show specific locations (such as addresses or geocoordinates) with colored markers for categories, or custom icons, plus text and images in popup windows. <br>Easy tool: [BatchGeo tutorial](batchgeo.html) or [Google My Maps tutorial](mymaps.html)<br>Power tool: [Ch 13: Leaflet Maps with Google Sheets tutorial](leaflet-maps-with-google-sheets.html) |
| Symbol point map<br> ![](images/placeholder.jpg) | Best to show specific locations (such as cities), with variable-sized shapes to represent data values (such as population growth).<br>Easy tool: [Symbol Map with Datawrapper tutorial](symbolmap-datawrapper.html) |
| Choropleth (colored polygon) map <br> ![](images/08-map/map-polygon.png) | Best to show geographic patterns across regions (such as neighborhoods or nations) by coloring polygons to represent data values. <br>Easy tool: [Choropleth map with Datawrapper tutorial](choropleth-datawrapper.html) or [Choropleth map with Tableau Public tutorial](map-tableau.html) <br>Power tools: [Ch 13: Leaflet Maps with Google Sheets tutorial](leaflet-maps-with-google-sheets.html) |
| Heat point map <br> ![](images/08-map/map-heat.png) | Best to show clusters of points as colored hotspots to emphasize high frequency. <br>Power tool: [Ch 13: Leaflet Heatmap code template](leaflet-heatmap.html) |
| Story map <br> ![](images/08-map/map-storymap.png) | Best to show a point-by-point guided tour, with a scrolling narrative to display images, audio, and video. <br> Power tool: [Ch 13: Leaflet Storymaps with Google Sheets tutorial](leaflet-storymaps-with-google-sheets.html) |
| Polyline map <br> ![](images/08-map/map-polyline.png) | Best to show routes (such as trails or transit), with colors for different categories. <br>Easy Tool: [Google My Maps tutorial](mymaps.html) <br>Power tool: [Ch 13: Leaflet Maps with Google Sheets tutorial](leaflet-maps-with-google-sheets.html)|
| Combination point-polyline-polygon map <br> ![](images/08-map/map-point-polygon-polyline.png) | Best to show any combination of points, polylines, or polygons, with custom icons for categories, and colored regions to represent data values. <br>Power tool: [Ch 13: Leaflet Maps with Google Sheets tutorial](leaflet-maps-with-google-sheets.html) |
| Searchable point map<br> ![](images/08-map/map-searchable.png) | Best to show specific locations for users to search by name or proximity, or filter by category, with optional list view.<br> Power Tool: [Ch 13: Leaflet Searchable Point Map code template](leaflet-searchable-map.html) |
| Current map from open-data repository<br> ![](images/08-map/map-open-data.png) | Best to show the most current information pulled directly from an open-data repository such as Socrata and others. <br>Easy tool: [Current map with Socrata open data tutorial](map-socrata.html)<br>Power tool: [Ch 13: Leaflet Maps with Open Data API code template](leaflet-maps-open-data-apis.html) |

## Map Design Principles {- #map-design}

Much of the data collected today includes a spatial component that can be mapped. When you look up an address on a city street, or take a photo of a tree in a rural forest, both can be geocoded into latitude and longitude coordinates, such as `42.76, -72.69`, and placed as *points* on a map. When we walk, bike, drive, or ride mass transit, our route can be recorded as strings of geocoordinates  and shown as *lines* on a map. When we draw lines to designate the geographic borders of neighborhoods or nations, we can display those *polygons* on a map, and also color them to represent different values, such as population or income.  

However, just because data *can* be mapped does not always mean it *should* be mapped. Before creating a map, stop and ask yourself: *Does location really matter to your story?* Even when your data includes geographic information, sometimes a chart tells your story better than a map. For example, you can clearly show differences between geographic areas in a bar chart, or trace how they rise and fall on different rates over time with a line chart, or compare two variables for each area in a scatter chart. Sometimes a simple table, or even text alone, communicates your point more effectively to your audience. Since creating a well-designed map requires time and energy, make sure it actually enhances your data story.

As you learned in the previous chapter about charts, data visualization is not a science, but comes with a set of principles and best practices that serve as a foundation for creating true and meaningful maps. In this section, we'll identify a few rules about map design, but you may be surprised to learn that some rules are less rigid than others, and can be "broken" when necessary to emphasize a point, as long as you are honestly interpreting the data. To begin to understand the difference, let's start by establishing a common vocabulary about maps.

### Deconstruct a Map {-}

Take a look at Figure \@ref(fig:map-principles-map) to get familiar with main
basic elements of maps, especially interactive ones featured in this book. Similar to a chart, good maps should include a title and brief description to provide context about what the map is showing.

(ref:map-principles-map) Map elements.

```{r map-principles-map, fig.cap="(ref:map-principles-map)"}
knitr::include_graphics("images/08-map/map-principles-map.png")
```

Map data is presented in layers. The top layer can be generally described as any combination of point, polyline, or polygon data. *Points* represent latitude and longitude coordinates, which may be illustrated by location markers. *Polylines* are connected strings of points, and we place the "poly-" prefix before "lines" to remind us that they may contain multiple branches, not just straight segments. *Polygons* represent areas defined by lines, such as building footprints or national boundaries. On interactive maps, any of these top-layer elements may display a hidden *tooltip* (when you hover the cursor over them) or a *popup* (when you click on them) that reveals additional information about its properties. Below these top data layers is the *basemap* layer, usually displayed as a seamless grid of tiles that cover the globe. Typically a basemap displays either satellite imagery (also known as raster tiles) or pictorial displays of streets and buildings (also known as vector tiles). Interactive maps often include zoom controls (`+` and `-` buttons) that allow you to view data from various "distances," which change the display of the tile layer.
The *legend* identifies the meaning of shapes or colors on the map. Maps may include a *north arrow* or *scale* to orient readers to direction and relative distance. Good maps also add the data sources, clarifying notes, and credits to the individuals or organizations that created them.

We spell out these definitions to help newer mapmakers to learn some general rules and to avoid making common mistakes. Many of the our guidelines about map design are inspired by excellent resources such as Datawrapper Academy posts about symbol maps and [choropleth maps](https://academy.datawrapper.de/article/134-what-to-consider-when-creating-choropleth-maps)

### Clarify Point versus Polygon Data {-}

Before you start to create a map, make sure you understand your data format and what it represents. Avoid mistakes commonly made by novices by pausing to ask these questions. First, *Can your data be mapped?* Sometimes the information we collect has no geographic component, or no consistent one, which makes it difficult or impossible to place on a map. If the answer is yes, then proceed to the second question: *Can the data be mapped as points or polygons?* These are the two most likely cases (which are sometimes confused), in contrast to the less-common third option, *polylines*, which represent paths and routes.

What type of data do you see listed below: points or polygons?

1. 36.48, -118.56 (latitude and longitude for Joshua Tree National Park, CA)
2. 2800 E Observatory Rd, Los Angeles, CA
3. Haight and Ashbury Street, San Francisco, CA      
4. Balboa Park, San Diego, CA                       
5. Census tract 4087, Alameda County, CA
6. City of Los Angeles, CA       
7. San Diego County, CA  
8. State of California     

In most cases, numbers 1-4 represent *point* data because each normally refers to a *specific location* that can be displayed as a marker on a map. These usually work best in point-data maps, such as:

- a *point map* to show locations with colored or custom icons
- a *symbol point map* to shows locations with variable-sized images to represent data (such as circles for population size)
- a *heat point map* to show clusters of locations as hotspots of high frequency
- a *story map* to show a point-by-point guided tour with a scrolling narrative

In most cases, numbers 5-8 represent *polygon* data because each normally refers to a *geographic boundary* that can be displayed as a shape on a map. These usually work best in *choropleth* maps, which show spatial patterns across regions by coloring polygons to represent data values.

TODO DISCUSS: Do we need to include small abstract map type images here to reinforce the concept? Or are the maps images in Table 8.1 above sufficient?

These point-versus-polygon rules apply *most* of the time, but not always, and exceptions can be made depending on your data story. First, it is *possible*, but not common, to represent all items 1-8 as *point* data, and display them on any of the point-style maps above. For example, to tell a data story about population growth for California cities, it would make sense to create a symbol point map with different-sized circles to represent data for each city. To do this, your map tool would need to find the center-point of the City of Los Angeles polygon boundary in order to place its population circle on a specific point on the map. A second way the point-versus-polygon rule gets blurry is because some places we normally consider to be map points *also* have polygon-shaped borders. For example, if you enter "Balboa Park" into Google Maps, it will display the result as a map marker, which suggests it is point data. But Balboa Park also has a geographic boundary that covers 1.8 square miles (4.8 square kilometers). If you told a data story about how much land in San Diego was devoted to public space, it would make sense to create a choropleth map that displays Balboa Park as a polygon rather than a point. Third, it's also possible to transform points into polygon data with [pivot tables, a topic we introduced in Chapter 3](pivot.html). For example, to tell a data story about the number of hospital beds each California county, you could obtain point-level data about beds in each hospital, then pivot them to sum up the total number of beds in each county, and display these polygon-level results in a choropleth map. See a more detailed example in the [Pivot Points into Polygon Data section of Chapter 14: Transform Your Map Data](pivot-point-to-polygon.html)

In summary, clarify if your spatial data should represent points or polygons, since those two categories are sometimes confused. If you envision them as points, then create a point-style map; or if polygons, then create a choropleth map. Those are the most common methods used by mapmakers, but there are plenty of exceptions, depending on your data story.

### Avoid Two Variables on One Map {-}
Newcomers to data visualization sometimes are so proud of placing one variable on a map that they figure two variables must be twice as good. But this usually is not true. In general, we recommend against placing two variables on the same map, because it's very difficult for most readers to recognize patterns that help them to grasp your data story. For example, look at what happens when you try to place one variable (using a symbol point map) on top of another variable (using a choropleth map), as shown with imaginary data in Figure \@ref(fig:map-two-variables). It's difficult to recognize patterns when a symbol point map is placed on a choropleth map.

(ref:map-two-variables) Avoid placing a symbol point map on top of a choropleth map, because it's hard to see the relationship between two variables.

```{r map-two-variables, out.width=400, fig.cap="(ref:map-two-variables)"}
knitr::include_graphics("images/08-map/map-two-variables.png")
```

Consider alternative ways to visualize the relationship between two variables. Rather than a map, you could create a scatter chart to show any relationship between variables X and Y. This type of chart works best if the relationship between variables is more important to your data story than any geographic patterns. Or, if geographic patterns matter for one of the variables, you could pair a choropleth map of that variable next to a scatterchart of both variables. Finally, you could create two choropleth maps, one for each variable, and place them side-by-side with text to explain their similarities or differences.

TODO: decide if the figure works above; also decide if supplemental images are needed, perhaps as "bad viz" and "better viz" examples

### Usually Choose Smaller Geographies for Choropleth Maps {-}
Choropleth maps are best for showing geographic patterns across regions by coloring polygons to represent data values. Therefore, we generally recommend selecting *smaller* geographies to display more *granular* patterns, since larger geographies display aggregated data that may hide what's happening at lower levels. Geographers refer to this concept as the [modifiable aerial unit problem](https://en.wikipedia.org/wiki/Modifiable_areal_unit_problem), which means that the way you slice up your data affects how we analyze its appearance on the map. Stacking together lots of small slices reveals more detail than one big slice.

For example, compare the two choropleth maps of typical home values in the Northeastern United States in according to [Zillow research data](https://www.zillow.com/research/data/) for August 2020. Zillow defines typical values as a smoothed, seasonally adjusted measure of all single-family residences, condos, and coops in the 35th to 65th percentile range, similar to the median value at the 50th percentile, with some additional lower- and higher-value homes. Both choropleth maps use the same scale. The key difference is the size of the geographic units: the first map shows home values at the larger state level, while the second map shows home values at the smaller county level, as shown in Figure \@ref(fig:choropleth-use-smaller-geos).

(ref:choropleth-use-smaller-geos) Zillow typical home values in August 2020 shown at the state level (left) and county level (right).

```{r choropleth-use-smaller-geos, fig.cap="(ref:choropleth-use-smaller-geos)"}
knitr::include_graphics("images/08-map/choropleth-use-smaller-geos.png")
```

Which map is best? Since both are truthful depictions of the data, the answer depends on the story you wish to tell. If you want to emphasize state-to-state differences, choose the first map because it clearly highlights how typical Massachusetts home prices are higher than those in surrounding Northeastern states. Or if you want to emphasize variation inside states, choose the second map, which demonstrates higher price levels in the New York City and Boston metropolitan regions, in comparison to more rural counties in those two states. If you're unsure, it's usually better to map smaller geographies, because it's possible to see both state-level and within-state variations at the same time, if the design includes appropriate labels and geographic outlines. But don't turn *smaller is better* into a rigid rule, since it doesn't work as you move further down the scale. For example, if we created a third map to display every individual home sale in the Northeastern US, it would be *too detailed* to see meaningful patterns. Sometimes larger-level geography tells a simple story more clearly.

TODO Above: add "New York City" and "Boston" labels to the county-level map. Decide if we should add state-level outlines and state names to county-level map. Do we wish to add a third map that's too detailed to illustrate the Goldilocks effect?

## Design Choropleth Colors & Intervals {-}

When you build a choropleth map, your choices about how to represent data with colors will determine its overall appearance, so it's important to learn key principles. Good choropleth maps make true and insightful geographic patterns clearly visible to readers, whether they are printed in black-and-white on paper or displayed in color on a computer screen. Furthermore, the best choropleth maps are designed to be interpreted correctly by color-blind readers.

To illustrate key concepts about colors in choropleth map design, let's explore a wonderful tool called [ColorBrewer](https://colorbrewer2.org/), created by Cynthia Brewer and Mark Harrower. See the interface in Figure \@ref(fig:map-colorbrewer). Since ColorBrewer is a design assistant, do not expect to upload your data into it to create a map. Instead, ColorBrewer will recommend color palettes that work best with our map data and the type of story we wish to tell, and allow us to export those color codes into our preferred mapping tool.

(ref:map-colorbrewer) The ColorBrewer interface: data classes, type of color scheme, and recommended color codes.

```{r map-colorbrewer, fig.cap="(ref:map-colorbrewer)"}
knitr::include_graphics("images/08-map/map-colorbrewer-annotated.png")
```

In this section, we'll focus on two important decisions you'll need to make when designing choropleth maps: choosing the type of color palette (sequential, divergent, or qualitative) and the intervals to group together similar-colored data points.

When you open [ColorBrewer](https://colorbrewer2.org/), the top row asks you to select the number of data classes in your choropleth map, which means the number of intervals or steps in your color range. This design tool can recommend distinct colors for up to twelve data classes, depending on the type of scheme you select. But for now, use the default setting of 3, and we'll return to this topic later when we discuss intervals in more detail further below.

### Choose Choropleth Palettes to Match Your Data {-}
One of the most important decisions you'll make when designing a choropleth map is to select the type of palette. You're not simply choosing a color, but the *arrangement of colors* to help readers correctly interpret your information. The rule is straightforward: choose an appropriate color palette that matches your data format, and the story you wish to tell.

ColorBrewer groups palettes into three types---sequential, diverging, and qualitative---as shown in Figure \@ref(fig:map-principles-color-schemes).

(ref:map-principles-color-schemes) Sequential, diverging, and qualitative color palettes from [ColorBrewer](https://colorbrewer2.org/).

```{r map-principles-color-schemes, fig.cap="(ref:map-principles-color-schemes)"}
knitr::include_graphics("images/08-map/map-principles-color-schemes.png")
```

*Sequential palettes* work best to show low-to-high numeric values. Examples include anything that can be placed in sequence on a scale, such as median income, amount of rainfall, or percent of the population who voted in the prior election. Sequential palettes can be single-hue (such as different shades of blue) or multi-hue (such as yellow-orange-red). Darker colors *usually* represent higher values, but not always.

*Diverging palettes* work best to show numbers above and below a standard level (such as zero, the average, or median value). They typically have two distinct hues to represent positive and negative directions, with darker colors at the extremes, and a neutral color in the middle. Examples include income above or below the median level, rainfall above or below seasonal average, or percentage of voters above or below the norm.

*Qualitative palettes* work best to show categorical data, rather than numeric scales. They typically feature unique colors that stand apart from one another to emphasize differences. Examples include different types of land use (residential, commercial, open space, water). They also can represent categories such as a warning system that resembles a stoplight (green, yellow, and red), as these specific colors must be manually assigned to be correctly interpreted.

Choose an appropriate palette that matches your data format and story you wish to tell. For example, we began with the same data on income per capita in the contiguous US states in 2018, but modified it demonstrate the interpretive strengths of each palette, as shown in Figure \@ref(fig:map-principles-classification).

The first map shows a *sequential* color scheme with five shades of blue to illustrate the low-to-high range of income levels. This map works best for a data story that emphasizes the highest income levels, shown by the darker blue colors along the Northeastern coast from Maryland to Massachusetts.

The second map shows a *diverging* color scheme to illustrate income levels at the low and high extremes. We modified the data by subtracting the average US per capita income value of $33,381 from each state's value. This new relative measure is dark orange for states far below the average, and dark purple for states far above it, while a neutral color represents the middle. This map works best for a data story that emphasizes an economic division between lower-income Southern states versus higher-income East Coast and West Coast states.

The third map shows a *qualitative* color scheme that divides the 48 contiguous states into 3 equal groups based on their per capita incomes, and paints them in the colors of a stoplight (red, yellow, and green) to represent low, middle, and top thirds.

TODO: Decide if we should keep or remove the third map, since it's not an ideal representation of qualitative data.

(ref:map-principles-classification) Representing per capita income in US states using three different classifications.

```{r map-principles-classification, out.width=500, fig.cap="(ref:map-principles-classification)"}
knitr::include_graphics("images/08-map/map-principles-classification.png")
```

After you select data classes and a color palette, ColorBrewer displays alphanumeric codes that web browsers translate into colors. You can select hexadecimal codes (`#ffffff` is white), RGB codes (`255,255,255` is white), or CMYK codes (`0,0,0,0` is white), and copy or export them into your preferred map tool, if it allows color palettes to be imported.

### Choose Color Intervals to Group Choropleth Map Data {-}

Another important design choice for choropleth maps is the color intervals, which determine how you group and display data by using similar colors. Since your ability to set intervals varies across different mapping tools, this section will explain broad concepts, and specific map tutorials will demonstrate how to apply them.

Some mapping tools allow you to choose two different *types of color intervals* to show movement up or down a data scale, as shown in Figure \@ref(fig:interval-types). *Steps* are clearly-marked color dividers, like a staircase, while *continuous* is a gradual change in hue, like a ramp.

(ref:interval-types) Two types of color intervals: steps and continuous.

```{r interval-types, out.width=300, fig.cap="(ref:interval-types)"}
knitr::include_graphics("images/08-map/interval-types.png")
```

If both options exist, which one is best? There is no clear map design rule about this. On one hand, some recommend using continuous intervals to show greater geographical diversity, except when it's important to your data story to display a threshold, where steps make sense to show areas above or below a certain line. On the other hand, some point out that people are quite bad at distinguishing different hues on a continuous scale, so recommend using clearly-defined steps to help readers match colors to data values in your legend. Therefore, our general advice is to make design choices that are both honest and insightful: tell the truth about the data and also draw our attention to what matters about this interpretation.[TODO: is this sufficient or should we add examples or cite different designers here? Cite Datawrapper Academy on "honesty and usefulness" https://academy.datawrapper.de/article/117-color-palette-for-your-map]

Some mapping tools also allow you to choose how to *interpolate* your data, meaning the method for grouping numbers to represent similar colors on your map. This may involve a two-part decision about step dividers and numerical methods.

First, if you choose *steps*, how many dividers should you use to slice up your data? Once again, there is no clear rule. Fewer steps creates a *coarse* map that highlights broad differences, while more steps creates a *granular* map that emphasizes geographic diversity between areas. But adding more steps also makes differences less visible. Remember that simply adding more colors does not necessarily make a better map. We recommend experimenting with [ColorBrewer](https://colorbrewer2.org) to raise or lower the *Number of data classes* (also known as steps or dividers) for different types of color palettes, to visualize the consequences of your possible design choices, as shown in Figure \@ref(fig:colorbrewer-steps). Make decisions with the best interests of your readers in mind, to represent your data in honest and insightful ways.

(ref:colorbrewer-steps) Experiment with ColorBrewer data classes (or steps) and color palettes.

```{r colorbrewer-steps, out.width=400, fig.cap="(ref:colorbrewer-steps)"}
knitr::include_graphics("images/08-map/colorbrewer-steps.png")
```

Second, whether you choose steps or continuous, which *interpolation* method is the best way to group your data into similar colors on your scale? Map tools may display the options in different ways, as seen in Figure \@ref(fig:intervals-datawrapper-tableau), and they also may vary depending on whether you selected steps or continuous colors.

(ref:intervals-datawrapper-tableau) Interpolation options in two map tools: Datawrapper (left) and Tableau Public (right).

```{r intervals-datawrapper-tableau, fig.cap="(ref:intervals-datawrapper-tableau)"}
knitr::include_graphics("images/08-map/intervals-datawrapper-tableau.png")
```

- *Linear* means that the values are placed in a straight line, from lowest to highest. This method works best when the data are evenly distributed, because the colors draw attention to the outliers at the low and high ends of the scale.
- *Quantiles* means that the values are divided into groups of an equal number. More specifically, *quartiles*, *quintiles*, and *deciles* mean dividing the values into four, five, or ten groups of equal quantity. This method works best when the data are not evenly distributed, because it uses colors to draw more attention to the diversity of groups inside the scale, not just the low and high ends.
- *Rounded values* are similar to quantiles, but decimals in the scale are replaced with rounded numbers that look nicer to readers' eyes.
- *Natural breaks (Jenks)* offers a compromise between linear (which emphasizes the extreme ends) and quantiles (which emphasize internal diversity).
- *Custom* allows you to manually place dividers wherever you wish along the color scale. We generally recommend to *not* use custom settings because they are more likely to create a misleading map, as you'll learn in [Chapter 15: Detect Lies and Reduce Data Bias](detect.html).

TODO: CONFIRM definitions above; add max/mid/min as an option? decide if these definitions are sufficient, or consider adding small maps to visually contrast the differences, as shown in https://academy.datawrapper.de/article/117-color-palette-for-your-map; cite this source

Which interpolation method is best? While there are no rigid rules, some methods above work better for different types of data stories. If you wish to emphasize the lows and highs in your data, choose linear because it uses color to draw attention to the extreme ends of the scale. Or if you wish to emphasize geographic diversity in your data, consider quantiles (or any of its cousins) because they use color to differentiate the middle portions of the scale. Or if you're not sure what your data looks like, [create a histogram like you learned in Chapter 7: Chart Your Data](chart-google.html) to visualize it and help make wise map design choices. [TODO: demonstrate a histogram with map data here? https://academy.datawrapper.de/article/294-how-to-customize-stepped-color-scales]

In any case, be very aware of how color palettes and interpolation dramatically shape the appearance of choropleth maps and how the data appears in readers' eyes. Always create maps show us the story and tell the truth.  [TODO: ADD THIS? In general, Datawrapper recommends choosing ranges to make sure readers "see all the differences in the data," rather than hiding them out of sight.... cite https://academy.datawrapper.de/article/134-what-to-consider-when-creating-choropleth-maps]

## Normalize Choropleth Map Data {-}

We introduced the concept of [normalizing data in Chapter 6: Make Meaningful Comparisons](normalize.html). Normalization means adjusting data that was collected using different scales into a common scale, in order to make more appropriate comparisons. For example, it makes little sense to compare the total number of Covid cases between nations with very different populations, such as XXX and YYY (TODO: fill in examples). A better strategy is to normalize the data by comparing cases per capita (such as A per 100,000 in XXX versus B per 100,000 in YYY) to adjust for prior differences in population.

In the same way, choropleth maps work best when they display relative values (such as percentages or per capita rates) rather than absolute values (such as the raw number of people). If you ignore normalization when creating a choropleth map and display raw numbers, you'll essentially recreate a population map, which doesn't tell us anything new. For example, compare two maps shown in Figure \@ref(fig:normalize-map-data). They both are about Covid-19 cases in the continental US as of June 26, 2020. Figure \@ref(fig:normalize-map-data)a shows total number of recorded cases per state, and Figure \@ref(fig:normalize-map-data)b shows Covid-19 cases adjusted by the state's population. Darker colors represent higher values. Do you notice any differences in spatial patterns?

(ref:normalize-map-data) Choropleth maps work best with normalized values.

```{r normalize-map-data, fig.cap="(ref:normalize-map-data)"}
knitr::include_graphics("images/14-transform/normalize-map-data-annotated.png")
```

Both maps show Covid-19 data collected by the New York Times and published [on GitHub](https://github.com/nytimes/covid-19-data). In the map in Figure \@ref(fig:normalize-map-data)b, we normalized values by dividing the total number of cases by the population in each state, according to the 2018 US Census American Community Survey, the most recent data available on the day of writing. We did not add legends and other important cartographic elements so that you can better focus on interpreting spatial patterns. In both cases, we used Jenks natural breaks for classification.

What are the worst-hit states according to the map showing total Covid-19 counts (shown in Figure \@ref(fig:normalize-map-data)a)? If you are familiar with the US geography, you can quickly tell that these are New York, New Jersey, Massachusetts, Florida, Illinois, Texas, and California. But five of these happen to be some of the most populous states in the US,
so it makes sense that they will also have higher Covid-19 cases.

Now, how about the map in Figure \@ref(fig:normalize-map-data)b? You can see that New York and its neighbors, including New Jersey and Massachusetts, have by far the highest rates per capita (per person), which we saw in the first map. But you can also see that in fact California, Texas, and Florida were impacted to a lesser extent than the map on the left had suggested. So the map with per-capita values is a much better illustration to the story about New York being the *first* epicenter of the Covid-19 crisis in the United States.

TODO: Include a very simple normalization calculation to demonstrate absolute data versus normalized data (Cases / Population = Cases Per Capita) for two states, such as Texas and New York. Decide whether to show data at a specific moment (May 1 2020 near peak for NYC) or most up-to-date figure at this writing (which will show higher case rates elsewhere). Either way, clearly label the date in the caption.

At this point, you should have a better idea of key principles in map design, and what makes them work (or not) when communicating data images to our eyes. In the next section, we'll begin our first hands-on tutorial with creating a point map. Later in the chapter we'll return to exercises in creating choropleth maps.  

## Point Map with BatchGeo {- #batchgeo}
TODO...
See also
https://blog.batchgeo.com/5-steps-to-become-a-batchgeo-power-user/

## Point Map with Google My Maps {- #mymaps}

TODO: Explain how Google My Maps is different from Google Maps....

[My Maps](https://www.google.com/maps/about/mymaps/) is Google's service
that allows users to create custom maps using Google Maps platform.
It is perhaps the fastest ways of building point and basic polygon maps, although
it limits your styling options.

My Maps is most powerful when it comes to collaboration. The platform functions
within Google Drive, and so allows you to invite
other users with Google accounts to work on the map.

In this section, we will look at building a point map of airports in Nigeria, as is shown
in Figure \@ref(fig:mymaps-final). We will
create a map, change a baselayer, import point data, style points, and share the map.

(ref:mymaps-final) A map of airports in Nigeria built using Google My Maps.

```{r mymaps-final, fig.cap="(ref:mymaps-final)"}
if(knitr::is_html_output(excludes="markdown")) knitr::include_url("https://www.google.com/maps/d/u/0/embed?mid=1v1ZNrpfBtq_p4wTRyj2hIKBtTnkmhnMF", height="500px") else knitr::include_graphics("images/08-map/mymaps-final.png")
```

### Create a New Map in My Maps {-}

Navigate to [Google My Maps](https://www.google.com/mymaps/).
In the upper-right corner, click `+ Create a New Map` button,
as shown in Figure \@ref(fig:mymaps-create-new).

(ref:mymaps-create-new) A map of airports in Nigeria built using Google My Maps.

```{r mymaps-create-new, out.width=300, fig.cap="(ref:mymaps-create-new)"}
knitr::include_graphics("images/08-map/mymaps-create-new.png")
```

You will see a typical Google Maps with no data. Click on the current title (`Untitled map`),
and add appropriate title and description in the modal window that appeared
(see Figure \@ref(fig:mymaps-edit-title) for inspiration).

(ref:mymaps-edit-title) Add title and description to your map.

```{r mymaps-edit-title, out.width=300, fig.cap="(ref:mymaps-edit-title)"}
knitr::include_graphics("images/08-map/mymaps-edit-title.png")
```

Before we add any points, let's change the basemap to something less boring.
At the bottom of the control window, open *Base map* dropdown, and pick one of nine available
basemaps. For this tutorial, we chose *Dark Landmass*.

Let's now proceed to the most important step—adding data. You can [download](data/nigeria-airports.csv)
a dataset of Nigerian airports that we got [from the World Bank](https://datacatalog.worldbank.org/dataset/nigeria-airports)
as a Shapefile and then converted to a CSV.

Under *Untitled layer* item, click *Import* button, and drag-and-drop the CSV file.
Once the data file is uploaded, My Maps will ask which columns contain location data.
In our case, these are *LATITUDE* and *LONGITUDE* columns, as shown in Figure \@ref(fig:mymaps-lat-lon).

(ref:mymaps-lat-lon) Check LATITUDE and LONGITUDE as your location columns.

```{r mymaps-lat-lon, out.width=300, fig.cap="(ref:mymaps-lat-lon)"}
knitr::include_graphics("images/08-map/mymaps-lat-lon-annotated.png")
```

Once the two boxes are checked, click *Continue*. Another window will pop up, asking
which column to use to annotate points. Choose *City*, as shown in Figure \@ref(fig:mymaps-column-title),
and then *Finish*.

(ref:mymaps-column-title) Choose City as the title for your markers.

```{r mymaps-column-title, out.width=300, fig.cap="(ref:mymaps-column-title)"}
knitr::include_graphics("images/08-map/mymaps-column-title-annotated.png")
```

It will take a few moments for My Maps to create a new layer, which
will be added to the layer menu as *nigeria-airports.csv*.
Once the layer is created, My Maps will center the map to fit the points.

Let's replace the original blue markers to orange airport symbols.
In layers menu, hover over *All items* and click the paint bucket symbol
on the right. Change "All items" text to "Airports",
choose orange color, and click on *More icons* to find an airport symbol
(we recommend using Filter to search for "airport", or simply scroll down to Transportation section).
The marker in the layers menu will change to an orange airplane,
as shown in Figure \@ref(fig:mymaps-color).

(ref:mymaps-color) In My Maps, you can change marker colors and icons.

```{r mymaps-color, out.width=300, fig.cap="(ref:mymaps-color)"}
knitr::include_graphics("images/08-map/mymaps-color-annotated.png")
```

Click on the layer name, which by default is set to the name of imported file (`nigeria-airports.csv`),
and change it to *Nigerian Airports*. Alternatively open a kebab menu to the right of the layer name, and choose *Rename this layer*.

You can accompany each marker with a label. Click *Uniform style* under the layer, and choose *Alt_name*
in the *Set labels* dropdown menu. You will see alternative airport names, such as *BENIN*, displayed
to the right of the markers.

Click *Preview* to see how the map looks like outside of the My Maps editing studio.

### Share Your Google My Map {-}

If you are happy with the result, click *Share*, and click *Change to anyone with the link*
(see Figure \@ref(fig:mymaps-share)),
just as you would with any other Google Drive document.

(ref:mymaps-share) Make sure anyone with the link can view your map before you share it.

```{r mymaps-share, out.width=400, fig.cap="(ref:mymaps-share)"}
knitr::include_graphics("images/08-map/mymaps-share.png")
```

You can now generate a code snippet to embed the map as an iframe.
From the main kebab menu to the right of the map title, choose *Embed on my site* (Figure \@ref(fig:mymaps-embed)).
You can use now use this iframe code to embed your map to
your Wordpress, Squarespace, or any other website.

(ref:mymaps-embed) My Maps can generate an iframe code to include the map on your own website.

```{r mymaps-embed, out.width=300, fig.cap="(ref:mymaps-embed)"}
knitr::include_graphics("images/08-map/mymaps-embed-annotated.png")
```

### Going Beyond Points {-}

Google My Maps has more powerful features for map making.
Instead of uploading datasets with latitude/longitude pairs,
you can use simple addresses (and My Maps will take care of geocoding),
or add markers by clicking on the map using *Add marker* feature.
You can classify points based on a property, and use different colors
to represent them.

You are not limited to just point maps. You can also draw your own shapes, including
lines and polygons. You can add data to multiple layers.
Unfortunately, Google My Maps has no comprehensive documentation,
so you have to explore the studio yourself if you want to create
more complex projects.

## Symbol Map with Datawrapper {- #symbolmap-datawrapper}
TODO: in progress https://academy.datawrapper.de/article/114-how-to-create-a-symbol-map-in-datawrapper

## Choropleth Map with Datawrapper {- #choropleth-datawrapper}

TODO: Review steps due to recent Datawrapper updates: see their new Academy pages on Choropleth interpolation (ranges) and colors

In addition to creating wonderful interactive charts, Datawrapper lets you create
stylish and interactive point and polygon maps.
In this section, we will create a choropleth map of average home values in US states
in 2019 according to [Zillow data](https://www.zillow.com/research/data/),
as shown in Figure \@ref(fig:datawrapper-map-final).

We calculated average 2019 prices for 50 US states and DC, and put them in a spreadsheet, which
[you can download](data/us-states-home-values-zillow-2019.csv) for this tutorial.

TODO: Move this here? Note: See [Normalize Data to Create Meaningful Choropleth Maps](normalize.html) section to learn why you should avoid displaying absolute values or counts in choropleth maps.

(ref:datawrapper-map-final) This choropleth map is created in Datawrapper

```{r datawrapper-map-final, fig.cap="(ref:datawrapper-map-final)"}
if(knitr::is_html_output(excludes="markdown")) knitr::include_url("https://datawrapper.dwcdn.net/uX2Yx/2/", height="513px") else knitr::include_graphics("images/08-map/datawrapper-map-final.png")
```

### Create a New Choropleth Map {-}

Sign in to your [Datawrapper account](https://app.datawrapper.de/signin)
and click *New Map* in the header. Datawrapper will offer a choice of
a *Choropleth*, *Symbol*, and *Locator* maps, as shown in Figure \@ref(fig:datawrapper-map-choose).
Go ahead and choose *choropleth*.

(ref:datawrapper-map-choose) Sign in to Datawrapper, click *New Map*, and choose *Choropleth*.

```{r datawrapper-map-choose, fig.cap="(ref:datawrapper-map-choose)"}
knitr::include_graphics("images/08-map/datawrapper-map-choose-annotated.png")
```

Datawrapper splits the process of creating a map into four steps.
In step one, you need to choose your map boundaries. Datawrapper has a
wide collection of most common geographical boundaries, including
states and counties and municipalities for most countries in the world,
and zip code and census tract areas for the United States. But you are not limited
to the boundaries that Datawrapper already has. You can also upload your own custom geographies
as a TopoJSON or GeoJSON file, and you will learn more about that in the [Convert to GeoJSON section of Chapter 14](convert-geojson.html).
Because we are mapping average home prices by US state, choose *United States > States*,
as shown in Figure \@ref(fig:datawrapper-map-us-states), and hit *Next* to go to step 2.

(ref:datawrapper-map-us-states) To map home prices by US state, choose appropriate boundaries.

```{r datawrapper-map-us-states, fig.cap="(ref:datawrapper-map-us-states)"}
knitr::include_graphics("images/08-map/datawrapper-map-us-states-annotated.png")
```

In the second step, you can attach data to the chosen boundaries.
You can set values manually in the interactive table that Datawrapper offers.
This is fine for several values, but is too time-consuming for all 50 values
(District of Columbia is not a US state, so is not present in the boundaries).
Instead, click *Import your dataset* button under the table.

Datawrapper will warn you that you need either *Names* (full state names, such as `Connecticut`),
or *ISO-Codes* (the standardized two-letter codes for the state, such as `CT` for Connecticut)
columns in order to perform merging.
Since the dataset that we prepared contains both columns (titled *State* and *StateAbbr*),
you can confidently press the *Start import* button.

TODO: convert this CSV file into a Google Sheet with data and notes tabs, which requires users to look at the data (even briefly) before downloading it

In the following window, you can either copy/paste values from the spreadsheet,
or upload a CSV file. We recommend uploading a file, so click the link and choose the file
`us-states-home-values-zillow-2019.csv`. The table will then get populated,
and Datawrapper will ask for help identifying the relevant column with geographical names.
Make sure your *Matched as ISO-Codes* tooltip is blue above the *StateAbbr* column,
scroll down and click *Next*, as shown in Figure \@ref(fig:datawrapper-map-match).

(ref:datawrapper-map-match) Tell Datawrapper which column contains geography names (ISO-Codes of states).

```{r datawrapper-map-match, out.width=350, fig.cap="(ref:datawrapper-map-match)"}
knitr::include_graphics("images/08-map/datawrapper-map-match.png")
```

In a similar fashion, you will then be asked to identify a column that contains *values* to be mapped. Make sure it is *HomeValue2019* that is *Matched As Values*.

### Select the color range {-}

TODO: Update and expand this section to match recent changes to Datawrapper

- Color palette: explain difference and best cases for using sequential, diverging, categorical colors, and refer back to ColorBrewer section above.
- Color type: steps vs continuous
- Interpolation (see below)
- see also Data Academy choropleth map design page

When finished uploading data, go to step 3 to begin visualizing. Start with the *Refine* tab and choose
a diverging color palette, from reds to blues. Make sure your "middle" color value
corresponds to the state with the median home price by choosing *min/median/max* value
from the Stops dropdown, as shown in Figure \@ref(fig:datawrapper-map-color).

(ref:datawrapper-map-color) Choose red/blues divergent color scheme, and make sure to match median with the neutral (middle) value.

```{r datawrapper-map-color, out.width=350, fig.cap="(ref:datawrapper-map-color)"}
knitr::include_graphics("images/08-map/datawrapper-map-color.png")
```

In the *Visualize* screen, next to *Select palette*, click the *wrench symbol* to open up the color settings, as shown in FIG TODO.

INSERT wide screenshot here

Below the color palette, experiment with the two *Types* of color ranges, as shown in FIG TODO. Click *Steps* to display values in the same range with the same color, like a staircase of steps at different heights. Now click *Continuous* to assign each value a color on the gradient, like a ramp that gradually goes up. Notice how the map menu and coloring changes according to type. For now, we'll use the default *Continuous* setting.

datawrapper-color-type.png

Experiment with the *Interpolation* menu, which refers to the method of assigning values along the color range you selected above.

TODO: consider using a simple dataset or histogram to illustrate the concepts below, similar to this Data Academy post https://academy.datawrapper.de/article/294-how-to-customize-stepped-color-scales

- *Linear* means that the values are placed in a straight line, from lowest to highest. This method is best when the data are evenly distributed, because the colors draw attention to the outliers at the low and high ends.
- *Quantiles* means that the values are divided into equal-count groups. More specifically, *quartiles*, *quintiles*, and *deciles* means dividing the values into four, five, or ten groups, where each group has an equal count. This method is best when the data are not evenly distributed, because the colors draw more attention to the diversity of groups inside the range, not just those at the ends.
- *Rounded values* are similar to quantiles, but decimals in the color range are replaced with nicer-looking rounded numbers.
- *Natural breaks (Jenks)* offers a compromise between linear (which emphasizes the extreme ends of the range) and quantiles (which emphasizes diversity inside the range).
- *Custom* allows you to manually place stops where you wish in the color range.

Notice how the menu options change depending on whether you select the *Type* to be *Steps* or *Continuous*, as shown in FIG TODO

BLEND or SIDE-BY-SIDE: datawrapper-continuous-interpolation.png and datawrapper-steps-interpolation.png

### Style and publish your map {-}

When finished with colors, scroll down to **Tooltips** section and
click *Customize tooltips* button. In a popup window, set Title to the state name
and Body to the average home value, as shown in Figure \@ref(fig:datawrapper-map-tooltip).
The easiest way to do this is to click on column names in the upper-right corner of the popup window, where all available names are listed, which is circled in Figure \@ref(fig:datawrapper-map-tooltip). Note that references to variables are put in double curly brackets (`{{ ColumnNameGoesHere }}`).
Make sure your dollar symbol (`$`) in outside of the curly brackets. Click *Save*,
and hover over the map to make sure your tooltip displays the state name and the average home price.

(ref:datawrapper-map-tooltip) To reference values from the spreadsheet, add column names in double curly brackets.

```{r datawrapper-map-tooltip, out.width=450, fig.cap="(ref:datawrapper-map-tooltip)"}
knitr::include_graphics("images/08-map/datawrapper-map-tooltip-annotated.png")
```

You can now move to the *Annotate* tab and set values for the map's title and description,
which is the line just below the title. Make sure you reference *Zillow Data* as data source.
Being transparent about your sources and methods adds credibility to your work.

In the final, fourth step, you can publish the chart and copy the iframe code that
Datawrapper generated for you.

Learn more about [choropleth map design in this excellent series of posts by the Datawrapper Academy](https://academy.datawrapper.de/category/93-maps).

Now that you've learned how to create a choropleth map using one tool, Datawrapper, let's compare the process using a different tool, Tableau Public.


## Choropleth Map with Tableau Public {- #map-tableau}

TODO: revise to make polygon/choropleth map vocab more consistent in this chapter;



TODO: Revise visual instructions to create choropleth map; drag a geo dimension (such as country name) directly into sheet to make map appear; then

WARNING: Tableau Public sometimes hides important items *behind* the "Show Me" panel. For example, the color palette menu....

In the previous chapter, we looked at using Tableau Public to build
[scattercharts](scatter-tableau.html) and [filtered line charts](filtered-line-tableau.html).
Tableau can also be used to create point and polygon maps.



In this tutorial, we will create a choropleth map of military spending per country
as percentage of gross domestic product as shown in Figure \@ref(fig:tableau-polygon-final).
Remember that choropleth maps work best when
they show relative, not absolute numbers.
Displaying total spending per country is a bad idea, as bigger countries tend
to have larger populations and as a result larger values for a lot of measures,
including military spending.

<!-- TODO: reminder that this Tableau visualization is stored in Ilya's account at https://public.tableau.com/profile/ilya7257#!/vizhome/MilitarySpending_15965362101320/Sheet1 -->

(ref:tableau-polygon-final) Filled Polygon (Choropleth) map: Explore the [interactive version](https://public.tableau.com/profile/ilya7257#!/vizhome/MilitarySpending_15965362101320/Sheet1). Data from TODO.

```{r tableau-polygon-final, fig.cap="(ref:tableau-polygon-final)"}
if(knitr::is_html_output(excludes="markdown")) knitr::include_url("https://public.tableau.com/views/MilitarySpending_15965362101320/Sheet1?:showVizHome=no&:embed=true", height="500px") else knitr::include_graphics("images/08-map/tableau-polygon-final.png")
```

ADD limitations of Tableau Public maps: work best when you enter places or regions that the software already recognizes by name or three-letter code

it's much easier if Tableau recognizes the geography and names (show list -- )
To create maps in Tableau, you do not always need geospatial files. Tableau can recognize
of a lot of locations, including boundaries for countries and territories, counties within countries,
states, US zip codes, airport codes, city locations, and some others. A simple spreadsheet that references
these locations can suffice. In this tutorial, we will rely on Tableau to automatically recognize country
names.

not ideal for point maps because you cannot geocode new street addresses, such as "1600 Pennsylvania Avenue, Washington DC" (TODO: Check)

Good for point symbol maps

Good for choropleth maps if the tool recognizes geographic names, but less ability to modify color ranges than Datawrapper....

If you require custom boundaries or points (such as town names in your local language),
take a look at [Create Tableau Maps from Spatial Files](https://help.tableau.com/current/pro/desktop/en-us/maps_shapefiles.htm)
article from the official Tableau documentation.


### Create a Choropleth Map in Tableau {-}

TODO: TODO: fix data because it currently includes several international regions, which are not nations; place inside Google Sheet; change "value" to "MilitaryPctGDP"

Before we begin, [download the 2018 data](data/military-spending-2018.csv) that we obtained from the World Bank.

Launch Tableau. In **Connect** section on start up, choose *Text file*, and select `military-spending-2018.csv`.
From Data Source tab, inspect the dataset contents. It contains four columns: Country Name, which includes
countries and territories defined by the World Bank, the three-digit Country Code,
Indicator Name (same for all rows), and percent value, as shown in Figure \@ref(fig:tableau-polygon-connect).
Notice that some values are set to *null* (not available).

(ref:tableau-polygon-connect) When finished inspecting the connected file, go to Sheet 1.

```{r tableau-polygon-connect, fig.cap="(ref:tableau-polygon-connect)"}
knitr::include_graphics("images/08-map/tableau-polygon-connect-annotated.png")
```

In the variables list on the left, notice how Tableau generated *Latitude* and *Longitude*
fields based on country names and country codes (by the way, you only need one or the other, not both).

Drag and drop Longitude to **Columns**, and *Latitude* to **Rows**,
as shown in Figure \@ref(fig:tableau-polygon-drag).
You should see that the chart area shows an empty map of the world
(if not, double-check that Latitude is indeed in Rows, not Columns).
In Marks box, change *Automatic* to *Map*, and drag *Country Name* variable
to the **Size** box of the Marks card. You will see that country outlines turned blue.

(ref:tableau-polygon-drag) Drag and drop variables to the right places.

```{r tableau-polygon-drag, fig.cap="(ref:tableau-polygon-drag)"}
knitr::include_graphics("images/08-map/tableau-polygon-drag-annotated.png")
```

We want colors to represent military spending values, so drag *Value* variable to
the **Color** box of the Marks card. You should now see a proper choropleth map.

Places like Greenland and Libya do not have available values, but they are still
painted with the lightest color, which is misleading. To remove countries with *null* values
from the map, drag *Values* to the *Filters* card. A popup window will ask you how
you want to filter, just leave everything unchanged. This will leave the whole range of values,
and exclude *null* values (see the checkbox in the lower-right corner of the Filter window
in Figure \@ref(fig:tableau-polygon-filter)).

(ref:tableau-polygon-filter) Filter values to remove countries with no data from display.

```{r tableau-polygon-filter, out.width=400, fig.cap="(ref:tableau-polygon-filter)"}
knitr::include_graphics("images/08-map/tableau-polygon-filter-annotated.png")
```

You can change the color scheme by clicking the Color box of the Marks card, and
then *Edit colors*. Change the palette to *Reds*, and make it stepped rather than continuous,
as shown in Figure \@ref(fig:tableau-polygon-color).

(ref:tableau-polygon-color) Change the color scheme to Reds with 5 steps.

```{r tableau-polygon-color, out.width=400, fig.cap="(ref:tableau-polygon-color)"}
knitr::include_graphics("images/08-map/tableau-polygon-color.png")
```

You may notice the tooltip calls values *Value* when hovering over countries.
Click the Tooltip box of the Marks card to change text to *Military spending*,
and add a percentage sign after the value itself, as shown in Figure \@ref(fig:tableau-polygon-tooltip).
Make sure not to change values between
`<` and `>`, as these are references to variables.

(ref:tableau-polygon-tooltip) Change tooltip text to make it more user-friendly.

```{r tableau-polygon-tooltip, out.width=400, fig.cap="(ref:tableau-polygon-tooltip)"}
knitr::include_graphics("images/08-map/tableau-polygon-tooltip.png")
```

And finally, let's add a proper title to the map. Double-click the default *Sheet 1* name
to bring up the *Edit Title* window, and change the name of your chart to a more meaningful
*Military Spending as % of GDP (2018)*.

### Create Dashboard and Publish Your Map {-}

TODO: make dashboard; change color range menu to floating, place on top of map, add title and sources...

Once you are ready to publish and share the map, go to *File > Save to Tableau Public*.
In the pop-up window, log in to your account if requested. Give it a title, such
as *Military Spending*, and click Save.

Now that you understand how to create maps using *static* data from a spreadsheet, let's explore how to create a map using the most current data available from an open-data repository.



## Current Map with Socrata Open Data {- #map-socrata}
TODO: revise to emphasize how the map continuously pulls the most current information directly from the open-data repository; in this case, happens to be filtered point map of hospitals in Texas.... TODO: replace with a better example of frequently-updated "live" data?

[Socrata](https://www.tylertech.com/products/socrata) is a database service that is used by government agencies,
cities and countries to make open data available to the public. It offers user-friendly ways to view, filter,
and export data. In addition, the Socrata platform includes built-in support to create interactive charts and maps,
which can be embedded in other websites (including your own).

One advantage of creating data visualizations directly on an open data platform is that the chart
or map is linked to the data repository. For example, if the Socrata platform administrator updates
the data table, then a Socrata dataviz based on that data will be automatically updated, too.
This may be especially useful for "live" data that is continuously updated by agency administrators
such as fires, crimes, and property data.

In this section, we will build an interactive point map of hospitals in Texas
using [General Hospital Information](https://data.medicare.gov/Hospital-Compare/Hospital-General-Information/xubh-q36u/data) dataset by Medicare,
which you can see in Figure \@ref(fig:socrata-final).

(ref:socrata-final) In this tutorial, we will build a point map of hospitals in Texas using Socrata.

```{r socrata-final, fig.cap="(ref:socrata-final)"}
if(knitr::is_html_output(excludes="markdown")) knitr::include_url("https://data.medicare.gov/dataset/Texas-Hospitals/cvhn-bsmn/embed?width=100%25&height=500", height="500px") else knitr::include_graphics("images/08-map/socrata-final.png")
```

Generally, in order to create a map in Socrata, you need to be a registered user,
and the dataset you wish to visualize has to contain a column with location data.
This is not just an address column (such as `3500 Gaston Avenue, Dallas, TX`), but
a geocoded column that contains latitude and longitude values.

### Sign Up for Socrata Account {-}

Navigate to [Data.Medicare.gov](https://data.medicare.gov/) click *Sign In* button
in the upper-right corner. Scroll down to *Sign Up* link. Follow the instructions,
including setting up two-step authentication, to create a free account.

Note: You can still practice creating a map in Socrata without being logged in.
You won't be able to save or share it, however.

Once you have an account, log in using your credentials. Navigate to your profile
by clicking your username in the upper-right corner and make sure you **Accept Terms and Conditions**,
otherwise you won't be able to save your draft map.

This username and password are only valid for Data.Medicare.gov, not other websites
that use Socrata.

### Create Your First Socrata Point Map {-}

Navigate to the [Hospital General Dataset](https://data.medicare.gov/Hospital-Compare/Hospital-General-Information/xubh-q36u/data),
and in the menu on the right-hand side choose *Visualize > Launch New Visualization*, as shown in Figure \@ref(fig:socrata-launch-new-viz). This will open up
a *Configure Visualization* studio where you can create the map.

(ref:socrata-launch-new-viz) Go to Visualize > Launch New Visualization.

```{r socrata-launch-new-viz, out.width=300, fig.cap="(ref:socrata-launch-new-viz)"}
knitr::include_graphics("images/08-map/socrata-launch-new-viz-annotated.png")
```

In the top menu, click *Map* (globe icon between a scatter chart icon and a calendar). You will
see an updated layout of the studio, with the map in the middle, and *Map Layers* and *Map Settings*
items in the side menu on the left.

Socrata was able to determine which column contains geospatial value, and automatically
set Geo Column value to *Location* in the *Layer List* menu. By default, points are clustered (grouped together),
so instead of seeing individual hospital locations, you see bubbles with numbers (such as `12` in Alaska).

Let's first select only hospitals that are located in the southern state of Texas.
To do so, go to *Filters > Add filter*. The dropdown menu lists all columns (or fields) of the dataset,
where we should choose *State*. In the newly appeared State dropdown, choose TX (for Texas) as shown in Figure \@ref(fig:socrata-filter), and scroll down
and click Apply. Socrata should zoom in on the map and center on Texas. Close *Filters* window to free screen space.

(ref:socrata-filter) Select Texas as the only value for State field.

```{r socrata-filter, out.width=300, fig.cap="(ref:socrata-filter)"}
knitr::include_graphics("images/08-map/socrata-filter-annotated.png")
```

Let's now **disaggregate** the map so that we can see individual hospitals instead of clusters.
Go to *Map Settings > Cluster*, and bring the *Stop Clustering at Zoom Level* slider to 1,
as shown in Figure \@ref(fig:socrata-uncluster).
You will see the map now shows individual points.

(ref:socrata-uncluster) To show individual points instead of clusters, set Stop Clustering at Zoom Level to 1.

```{r socrata-uncluster, out.width=300, fig.cap="(ref:socrata-uncluster)"}
knitr::include_graphics("images/08-map/socrata-uncluster-annotated.png")
```

In the same accordion menu, change *Basemap > Type* to *Dark* to bring the map a fashionable 2020 look.
In *General*, set Title to *Texas Hospitals*, and hide data table below the map by unchecking the
*Show data table below visualization* box. Under *Map Controls*, uncheck *Show Search Bar* and *Show Locate Button*
to get rid of unnecessary elements. Feel free to experiment with other settings as well.

Now, let's return back to **Map Layers** menu and choose our *Hospitals General Information*
point layer. You can notice that in *Data Selection* accordion menu, *Resize Points by Value*
is grayed out. That is because the dataset doesn't contain columns with continuous variables
that can be transformed to point sizes. Instead, we can use *Style by Value* option to
classify categorical points. The dataset contains multiple variables that can be effectively visualized,
such as *Hospital Type*, *Emergency Services* (a yes/no category), *Mortality national comparison* and others.
Let's stick with *Hospital Type*, as is illustrated in Figure \@ref(fig:socrata-style).

(ref:socrata-style) Let's display different types of hospitals in different colors.

```{r socrata-style, out.width=300, fig.cap="(ref:socrata-style)"}
knitr::include_graphics("images/08-map/socrata-style-annotated.png")
```

If you look at the bottom-right corner of the map, you should notice a minimized *Legend* control.
Click on it to see what each color represents.

Change the color palette (in *Color* menu) from *Categorical 1* to *Categorical 2*,
which includes a wider range of unique colors. You can also use *Custom...*
item to set individual colors, as well as change the order of categories in the legend.

To change what is shown in tooltips when you hover or click on points,
go to **Flyout Details**, and set Flyout Title to *Facility Name*,
adding city and phone number as additional flyout values, as is shown in Figure
\@ref(fig:socrata-flyout).

(ref:socrata-flyout) To edit tooltip information, use Flyout Details menu item.

```{r socrata-flyout, out.width=300, fig.cap="(ref:socrata-flyout)"}
knitr::include_graphics("images/08-map/socrata-flyout.png")
```

At this point you should have a fully-functional interactive map
showing all hospitals in Texas, colored according to their type.
Before you can share it, you need to save it as a draft, and publish.

#### Save Draft and Publish {-}

In the lower-right corner, click *Save Draft* button. Give your map a name,
and hit *Save*. The gray ribbon at the top will tell you it is still a draft,
and you can go ahead and *Publish...* it.

Now you can embed the map on your website as an iframe. To do so, click the *Share* button in the upper-right side of your map (see Figure \@ref(fig:socrata-share)),
and copy the generated code from *Embed Code* text area (Figure \@ref(fig:socrata-share-embed)).
Learn more in [Chapter 10: Embed on the Web](embed.html).

(ref:socrata-share) Click *Share* button to bring up *Share and Embed* window.

```{r socrata-share, out.width=400, fig.cap="(ref:socrata-share)"}
knitr::include_graphics("images/08-map/socrata-share-annotated.png")
```

(ref:socrata-share-embed) Copy iframe code to embed this map in another website.

```{r socrata-share-embed, fig.cap="(ref:socrata-share-embed)"}
knitr::include_graphics("images/08-map/socrata-share-embed.png")
```

### Limitations of Socrata {-}

But there are limitations to creating your chart or map on an open data repository platform.
First, if the agency stops using the platform, or changes the structure of the underlying data,
your online map (or chart) may stop functioning. Second, you are generally limited to using datasets
and geographic boundaries that already exist on that platform.

If these limitations concern you, a simple alternative is to export data from the
open repository (which means that any "live" data would become "static"), and
import it into your preferred dataviz tool, such as Tableau.

A second, more advanced alternative, is to learn to pull live data from Socrata using
an API (Application Programming Interface). That requires
coding skills that are beyond the scope of this book.
Visit the [official documentation](https://dev.socrata.com/) to learn more about Socrata API.

### Summary {- #summary8}

In this chapter, we looked at free mapping platforms to create simple point and polygon maps.
Google My Maps is a good choice for point maps that can be created in collaboration with others.
If the data you are interested in lives on Socrata platform, you might be able to create a point
map within the platform itself, and embed it as an iframe in your own website.
Tableau is another very powerful tool to build and share polygon and point maps.

In reviewing all these tools, we only scratched the surface and showed simple examples
to get you started quickly. All platforms allow layering data to create powerful exploration
mapping visualizations.

None of the platforms required special geospatial data, as all were smart enough to perform
geocoding and know the boundaries and coordinates of objects given to them.
In [Chapter 14](transform.html), we will talk more about geospatial data,
how it can be obtained, stored, modified, and shared.
